{
  "hash": "7b906db921b25293c8d197289ac329c8",
  "result": {
    "markdown": "---\ntitle: 从pdf读取表格\ndate: \"2024-04-10\"\ncategories: [R]\n---\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(docxtractr)\n```\n:::\n\n\n最近看到烟草局招聘，想报个名，结果发现招聘信息表都放在pdf里，不方便做筛选，于是想用R来提取数据框并处理一下。\n\n# 提取pdf中数据框的常见方案\n\n回顾用R从pdf中读取数据的常见方案及其弊端：\n\n1.  [用`pdftools`读取文本，再整理成数据框](https://tellingstorieswithdata.com/07-gather.html#pdfs)：\n    -   实际上就是用正则表达式清洗文本数据，步骤比较繁琐。\n\n    -   表格页数较多或者表格的格式较复杂的时候容易出错。\n\n\n\n2.  [用`tabulizer`从pdf中提取数据框](https://www.r-bloggers.com/2019/09/pdf-scraping-in-r-with-tabulizer/)：\n\n    -   需要配置java，非常麻烦。\n\n    -   提取的结果不准确。\n\n3.  [连接pdftables调用api](https://cran.r-project.org/web/packages/pdftables/index.html)：\n\n    -   需要在网站上注册，每次使用还需要输入账号和密码。\n    -   提取的结果不准确。\n\n\n\n下面这个表格存在单元格内换行的情况，用`pdftools`根本就无从下手，用`tabulizer`或`pdftables`也容易出错。\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](071052144z0f.pdf){fig-align='center' width=100%}\n:::\n:::\n\n\n\n# 用`docxtractr`提取\n\n我发现了一个包[`doxtractr`](https://gitlab.com/hrbrmstr/docxtractr)可以很轻松的提取word中的数据，对于一些格式复杂的pdf可以转换成word，然后用`doxtractr`包读取数据。\n\n为什么pdf转换成word后就能准确提取表格了呢？我猜测这是因为pdf是一种矢量结构，不具备并不会用code注明哪些元素是表格哪些元素是文字，pdf中的元素只有位置的区别而没有属性的区别。而word会标明哪些元素是表格，就像在编程里声明了表格这种class，因此容易提取。\n\n将pdf用word打开并另存为word后，用`docxtratr`包的`read_docx()`读入\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndocs <- read_docx(\"071052144z0f.docx\")\ndocs\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWord document [071052144z0f.docx]\n\nTable 1\n  total cells: 88\n  row count  : 8\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 2\n  total cells: 88\n  row count  : 8\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 3\n  total cells: 88\n  row count  : 8\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 4\n  total cells: 88\n  row count  : 8\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 5\n  total cells: 88\n  row count  : 8\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 6\n  total cells: 88\n  row count  : 8\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 7\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 8\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 9\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 10\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 11\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 12\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 13\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 14\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 15\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 16\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 17\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 18\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 19\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 20\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 21\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 22\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 23\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 24\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 25\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 26\n  total cells: 77\n  row count  : 7\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n\nTable 27\n  total cells: 33\n  row count  : 3\n  uniform    : likely!\n  has header : likely! => possibly [用人单位, 具体单位, 岗位名称, 岗位简介（主要职责描述）, 岗位代码, 招聘人数, 所需专业名称, 学历学位, 政治面貌, 毕业年限, 备注]\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nNo comments in document\n```\n:::\n:::\n\n\n可以看到文档中的表格被自动识别，并且推断出的表格的表头都是正确的。\n\n\n使用`docx_extract_tbl()`提取表格\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndocx_extract_tbl(docs, tbl_number = 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 11\n  用人单位            具体单位 岗位名称 岗位简介.主要职责描述. 岗位代码 招聘人数\n  <chr>               <chr>    <chr>    <chr>                  <chr>    <chr>   \n1 河南省烟草专卖局（… 内设机构 经济运…  负责经济运行管理等工…  10101    1       \n2 河南省烟草专卖局（… 内设机构 科技项…  负责科技项目管理等工…  10102    1       \n3 河南省烟草专卖局（… 内设机构 企业法…  负责法治建设等工作。   10103    1       \n4 河南省烟草专卖局（… 内设机构 资金管…  负责会计核算工作；负…  10104    1       \n5 河南省烟草专卖局（… 内设机构 营销管…  负责卷烟营销数据采集…  10105    1       \n6 河南省烟草专卖局（… 内设机构 营销管…  负责卷烟营销数据采集…  10106    1       \n7 河南省烟草专卖局（… 内设机构 综合管…  负责行政后勤管理等工…  10107    1       \n# ℹ 5 more variables: 所需专业名称 <chr>, 学历学位 <chr>, 政治面貌 <chr>,\n#   毕业年限 <chr>, 备注 <chr>\n```\n:::\n:::\n\n\n\n这里我们的pdf有27页，每页的表格都是固定的表头，可以用`docx_extract_all_tbls()`提取全部表格再按行合并。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntbls <- docx_extract_all_tbls(docs)\nrecruitment <- bind_rows(tbls)\nrecruitment\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 164 × 11\n   用人单位          具体单位 岗位名称  岗位简介.主要职责描述. 岗位代码 招聘人数\n   <chr>             <chr>    <chr>     <chr>                  <chr>    <chr>   \n 1 河南省烟草专卖局… 内设机构 经济运行… 负责经济运行管理等工…  10101    1       \n 2 河南省烟草专卖局… 内设机构 科技项目… 负责科技项目管理等工…  10102    1       \n 3 河南省烟草专卖局… 内设机构 企业法律… 负责法治建设等工作。   10103    1       \n 4 河南省烟草专卖局… 内设机构 资金管理… 负责会计核算工作；负…  10104    1       \n 5 河南省烟草专卖局… 内设机构 营销管理… 负责卷烟营销数据采集…  10105    1       \n 6 河南省烟草专卖局… 内设机构 营销管理… 负责卷烟营销数据采集…  10106    1       \n 7 河南省烟草专卖局… 内设机构 综合管理… 负责行政后勤管理等工…  10107    1       \n 8 河南省烟草专卖局… 内设机构 网络安全… 负责网络和信息安全等…  10108    1       \n 9 河南省烟草专卖局… 内设机构 质量监督… 负责烟草制品质量监督…  10109    1       \n10 中国烟草河南进出… 内设机构 会计（审… 负责会计核算工作；负…  10110    1       \n# ℹ 154 more rows\n# ℹ 5 more variables: 所需专业名称 <chr>, 学历学位 <chr>, 政治面貌 <chr>,\n#   毕业年限 <chr>, 备注 <chr>\n```\n:::\n:::\n\n\n数据的提取到这里就完成了，可以进行下一步的分析，或者将数据导出成excel。\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}