{
  "hash": "26bffcda6876045fe461475d9ec73383",
  "result": {
    "markdown": "---\ntitle: 四人追逐游戏\ncategories: [R, coding]\ndate: \"2024-03-10\"\n---\n\n\n游戏的设定是四个人A，B，C，D站在四个角，A追B，B追C，C追D，D追A。高数里面好像经常有类似的题目，今天用代码来模拟一下。\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndt_list <- list(\n  tibble(\n    name = c(\"A\", \"B\", \"C\", \"D\"),\n    x = c(1, 1, -1, -1),\n    y = c(1, -1, -1, 1),\n    direction = c(2, 3, 4, 1),\n    n = 0\n  )\n)\n```\n:::\n\n\n生成一个`tibble`，其中\n\n-   `name`列表示四个人的名字。\n-   `x`、`y`是坐标。\n-   `direction`列表示追逐的人的行号，比如A追B，B在第二行，所以A对应的`direction`是2。\n-   `n`表示跑了几步，目前没有开始追，所以是0步。\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# 设置程序最多跑5000步，防止程序出错而不收敛\nN <- 5000   \n# 设置每一步的步长\nstep_length <- 0.01\n\n# 开始循环\nfor (i in 1:N) {\n  dt = dt_list[[i]]\n  x_diff = max(dt$x) - min(dt$x)\n  y_diff = max(dt$y) - min(dt$y)\n  # 因为x,y是浮点数，最终可能每个点的x,y都十分接近但不相等，因此用near()来判断\n  if (!all(near(c(x_diff, y_diff), 0))) {\n    dt_list[[i + 1]] <- dt %>% \n      # 每个人向所追的方向迈一步\n      mutate(x_d = as_vector(dt[direction, \"x\"] - x),\n             y_d = as_vector(dt[direction, \"y\"] - y),\n             x = x + x_d * step_length,\n             y = y + y_d * step_length,\n             n = i)\n  } else {\n    break\n  }\n}\n```\n:::\n\n\n整理一下结果\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndt <- do.call(bind_rows, dt_list)\ndt\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7,572 × 7\n   name       x      y direction     n     x_d     y_d\n   <chr>  <dbl>  <dbl>     <dbl> <dbl>   <dbl>   <dbl>\n 1 A      1      1             2     0 NA      NA     \n 2 B      1     -1             3     0 NA      NA     \n 3 C     -1     -1             4     0 NA      NA     \n 4 D     -1      1             1     0 NA      NA     \n 5 A      1      0.98          2     1  0      -2     \n 6 B      0.98  -1             3     1 -2       0     \n 7 C     -1     -0.98          4     1  0       2     \n 8 D     -0.98   1             1     1  2       0     \n 9 A      1.00   0.960         2     2 -0.0200 -1.98  \n10 B      0.960 -1.00          3     2 -1.98    0.0200\n# ℹ 7,562 more rows\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndt %>% \n  slice_max(n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 7\n  name         x        y direction     n      x_d      y_d\n  <chr>    <dbl>    <dbl>     <dbl> <dbl>    <dbl>    <dbl>\n1 A      7.44e-9  4.30e-9         2  1892 -3.05e-9 -1.19e-8\n2 B      4.30e-9 -7.44e-9         3  1892 -1.19e-8  3.05e-9\n3 C     -7.44e-9 -4.30e-9         4  1892  3.05e-9  1.19e-8\n4 D     -4.30e-9  7.44e-9         1  1892  1.19e-8 -3.05e-9\n```\n:::\n:::\n\n\n达到收敛的状态花了1892步，即在步长为0.01时，1892步后四人追到彼此。\n\n看下四个人的轨迹\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndt %>% \n  ggplot(aes(x, y, color = n, pch = name)) +\n  geom_point(alpha = 0.2, size = 3) +\n  geom_text(data = dt_list[[1]],\n            aes(x, y, label = name),\n            nudge_x = 0.1,\n            nudge_y = 0.1) +\n  coord_equal() +\n  scale_color_viridis_c(option = \"C\", end = 0.8, begin = 0.4) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](03_四人追逐游戏_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=672}\n:::\n:::\n",
    "supporting": [
      "03_四人追逐游戏_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}