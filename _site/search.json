[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "This blog is under building."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "My Blog",
    "section": "",
    "text": "second\n\n\n\n\n\n\n\n\n\n\n\n\nBowen Qin\n\n\n\n\n\n\n  \n\n\n\n\n人口数据\n\n\n\n\n\n\n\nR\n\n\ndata analysis\n\n\n\n\n\n\n\n\n\n\n\nFeb 29, 2024\n\n\nBowen Qin\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/02-second/second.html",
    "href": "posts/02-second/second.html",
    "title": "second",
    "section": "",
    "text": "历史地理骄傲\n\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.0     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nChickWeight %&gt;% \n  ggplot(aes(Time, weight, color = Diet)) +\n  geom_point()"
  },
  {
    "objectID": "posts/post-with-code/index.html",
    "href": "posts/post-with-code/index.html",
    "title": "Post With Code",
    "section": "",
    "text": "This is a post with executable code.\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To My Blog",
    "section": "",
    "text": "This is the first post in a Quarto blog. Welcome!\n\nSince this post doesn’t specify an explicit image, the first image in the post will be used in the listing page of posts."
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html",
    "href": "posts/01-first/十年来人口数据分析.html",
    "title": "人口数据",
    "section": "",
    "text": "文章之前发布在和鲸社区。\nlibrary(tidyverse)\nlibrary(ggrepel)"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#读入数据",
    "href": "posts/01-first/十年来人口数据分析.html#读入数据",
    "title": "人口数据",
    "section": "读入数据",
    "text": "读入数据\n\ndt_rate &lt;- read_csv(\"data/出生率死亡率自然增长率.csv\",\n                    locale = locale(encoding = \"GBK\"))\n\nRows: 3 Columns: 10\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (1): 指标\ndbl (9): 2022年, 2021年, 2020年, 2019年, 2018年, 2017年, 2016年, 2015年, 2014年\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\ndt_rate &lt;- dt_rate %&gt;% \n  pivot_longer(\n    cols = - 指标,\n    names_to = \"year\"\n  ) %&gt;% \n  pivot_wider(\n    names_from = 指标\n  ) %&gt;% \n  mutate(year = parse_number(year))\ndt_rate\n\n# A tibble: 9 × 4\n   year `人口出生率(‰)` `人口死亡率(‰)` `人口自然增长率(‰)`\n  &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;               &lt;dbl&gt;\n1  2022            6.77            7.37               -0.6 \n2  2021            7.52            7.18                0.34\n3  2020            8.52            7.07                1.45\n4  2019           10.4             7.09                3.32\n5  2018           10.9             7.08                3.78\n6  2017           12.6             7.06                5.58\n7  2016           13.6             7.04                6.53\n8  2015           12.0             7.07                4.93\n9  2014           13.8             7.12                6.71\n\n\n其他数据集和该数据集情况类似，可以写个函数批量读入和整理。\n\nread_pivot &lt;- function(file) {\n  read_csv(file, locale = locale(encoding = \"GBK\")) %&gt;% \n    pivot_longer(\n    cols = - 指标,\n    names_to = \"year\"\n  ) %&gt;% \n  pivot_wider(\n    names_from = 指标\n  ) %&gt;% \n  mutate(year = parse_number(year))\n}\n\n\nfiles &lt;- fs::dir_ls(\"data\")\nfile_names &lt;- str_c(\"dt_\", c(\"age_dist\", \"rate\", \"education\", \"female\", \"marriage\", \"age\", \"gender\", \"population\", \"male\"))\nbind_cols(files, file_names)\n\nNew names:\n• `` -&gt; `...1`\n• `` -&gt; `...2`\n\n\n# A tibble: 9 × 2\n  ...1                            ...2         \n  &lt;fs::path&gt;                      &lt;chr&gt;        \n1 data/人口年龄分布.csv           dt_age_dist  \n2 data/出生率死亡率自然增长率.csv dt_rate      \n3 data/受教育程度.csv             dt_education \n4 data/女性年龄分布.csv           dt_female    \n5 data/婚姻状况.csv               dt_marriage  \n6 data/年龄结构.csv               dt_age       \n7 data/性别比.csv                 dt_gender    \n8 data/总人口.csv                 dt_population\n9 data/男性年龄分布.csv           dt_male      \n\n\n\ndt_list &lt;- map(files, read_pivot)\ndt_list &lt;- set_names(dt_list, file_names)\ndt_list[1]\n\n$dt_age_dist\n# A tibble: 10 × 22\n    year 人口数(人口抽样调查)(人…¹ 0-4岁人口数(人口抽样…² 5-9岁人口数(人口抽样…³\n   &lt;dbl&gt;                     &lt;dbl&gt;                  &lt;dbl&gt;                  &lt;dbl&gt;\n 1  2023                        NA                     NA                     NA\n 2  2022                   1443996                  62248                  90793\n 3  2021                   1494054                  72978                  96094\n 4  2020                        NA                     NA                     NA\n 5  2019                   1091876                  62722                  60701\n 6  2018                   1144648                  67393                  63322\n 7  2017                   1145246                  68313                  63314\n 8  2016                   1158019                  68447                  63831\n 9  2015                  21312241                1243566                1174724\n10  2014                   1124402                  63990                  63132\n# ℹ abbreviated names: ¹​`人口数(人口抽样调查)(人)`,\n#   ²​`0-4岁人口数(人口抽样调查)(人)`, ³​`5-9岁人口数(人口抽样调查)(人)`\n# ℹ 18 more variables: `10-14岁人口数(人口抽样调查)(人)` &lt;dbl&gt;,\n#   `15-19岁人口数(人口抽样调查)(人)` &lt;dbl&gt;,\n#   `20-24岁人口数(人口抽样调查)(人)` &lt;dbl&gt;,\n#   `25-29岁人口数(人口抽样调查)(人)` &lt;dbl&gt;,\n#   `30-34岁人口数(人口抽样调查)(人)` &lt;dbl&gt;, …"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#数据清洗",
    "href": "posts/01-first/十年来人口数据分析.html#数据清洗",
    "title": "人口数据",
    "section": "数据清洗",
    "text": "数据清洗\n读入的数据大都不符合整洁数据（一行是一个观测，一列是一个变量）的标准，为了方便作图和分析，需要对数据做一些清洗。\n\n# 人口年龄分布\ndt_list$dt_age_dist &lt;- dt_list$dt_age_dist %&gt;% \n  pivot_longer(\n    cols = - c(year, `人口数(人口抽样调查)(人)`),\n    names_to = \"年龄段\",\n    values_to = \"人口数\"\n  ) %&gt;% \n  mutate(`年龄段` = str_remove(`年龄段`, \"人口数.+\")) %&gt;% \n  rename(`总人口数` = `人口数(人口抽样调查)(人)`)\n\ndt_list$dt_age_dist\n\n# A tibble: 200 × 4\n    year 总人口数 年龄段  人口数\n   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;\n 1  2023       NA 0-4岁       NA\n 2  2023       NA 5-9岁       NA\n 3  2023       NA 10-14岁     NA\n 4  2023       NA 15-19岁     NA\n 5  2023       NA 20-24岁     NA\n 6  2023       NA 25-29岁     NA\n 7  2023       NA 30-34岁     NA\n 8  2023       NA 35-39岁     NA\n 9  2023       NA 40-44岁     NA\n10  2023       NA 45-49岁     NA\n# ℹ 190 more rows\n\n\n\n# 出生率死亡率自然增长率\ndt_list$dt_rate &lt;- dt_list$dt_rate %&gt;% \n  pivot_longer(\n    cols = -year,\n    names_to = \"比率名称\",\n    names_pattern = \"人口([^\\\\(]+)\",\n    values_to = \"比值\"\n  )\ndt_list$dt_rate\n\n# A tibble: 27 × 3\n    year 比率名称    比值\n   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;\n 1  2022 出生率      6.77\n 2  2022 死亡率      7.37\n 3  2022 自然增长率 -0.6 \n 4  2021 出生率      7.52\n 5  2021 死亡率      7.18\n 6  2021 自然增长率  0.34\n 7  2020 出生率      8.52\n 8  2020 死亡率      7.07\n 9  2020 自然增长率  1.45\n10  2019 出生率     10.4 \n# ℹ 17 more rows\n\n\n\n# 受教育程度\ndt_list$dt_education &lt;- dt_list$dt_education %&gt;% \n  select(-matches(\"[^性]人口数|6岁及6岁以上.性\")) %&gt;% \n  pivot_longer(\n    cols = -year,\n    values_to = \"人口数\",\n    names_to = c(\"教育程度\", \"性别\"),\n    names_pattern = \"6岁及6岁以上([^男|女]+)(男性|女性)人口数\\\\(人口抽样调查\\\\)\\\\(人\\\\)\"\n  )\n\n\ndt_list$dt_education\n\n# A tibble: 170 × 4\n    year 教育程度   性别  人口数\n   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;\n 1  2022 未上过学   男性   14948\n 2  2022 未上过学   女性   36444\n 3  2022 小学       男性  167013\n 4  2022 小学       女性  188341\n 5  2022 初中       男性  252064\n 6  2022 初中       女性  215929\n 7  2022 高中       男性  123426\n 8  2022 高中       女性   99455\n 9  2022 大专及以上 男性  137692\n10  2022 大专及以上 女性  127723\n# ℹ 160 more rows\n\n\n\n# 女性年龄分布\ndt_list$dt_female &lt;- dt_list$dt_female %&gt;% \n  select(-`女性人口数(人口抽样调查)(人)`) %&gt;% \n  pivot_longer(\n    cols = -year,\n    names_to = c(\"年龄段\", \"性别\"),\n    names_pattern = \"([^女]+)(女性)\",\n    values_to = \"人口数\"\n  )\n  \ndt_list$dt_female\n\n# A tibble: 160 × 4\n    year 年龄段  性别  人口数\n   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;\n 1  2022 0-4岁   女性   29658\n 2  2022 5-9岁   女性   42783\n 3  2022 10-14岁 女性   42781\n 4  2022 15-19岁 女性   36873\n 5  2022 20-24岁 女性   34483\n 6  2022 25-29岁 女性   40234\n 7  2022 30-34岁 女性   56267\n 8  2022 35-39岁 女性   53435\n 9  2022 40-44岁 女性   47957\n10  2022 45-49岁 女性   51025\n# ℹ 150 more rows\n\n\n\n# 男性年龄分布\ndt_list$dt_male &lt;- dt_list$dt_male %&gt;% \n  select(-`男性人口数(人口抽样调查)(人)`) %&gt;% \n  pivot_longer(\n    cols = -year,\n    names_to = c(\"年龄段\", \"性别\"),\n    names_pattern = \"([^男]+)(男性)\",\n    values_to = \"人口数\"\n  )\ndt_list$dt_male\n\n# A tibble: 160 × 4\n    year 年龄段  性别  人口数\n   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;\n 1  2022 0-4岁   男性   32589\n 2  2022 5-9岁   男性   48010\n 3  2022 10-14岁 男性   49065\n 4  2022 15-19岁 男性   42687\n 5  2022 20-24岁 男性   39146\n 6  2022 25-29岁 男性   44806\n 7  2022 30-34岁 男性   60488\n 8  2022 35-39岁 男性   56397\n 9  2022 40-44岁 男性   50422\n10  2022 45-49岁 男性   52930\n# ℹ 150 more rows\n\n\n\n# 性别比\ndt_list$dt_gender &lt;- dt_list$dt_gender %&gt;% \n  pivot_longer(\n    cols = -c(year, `性别比(女=100)(人口抽样调查)`),\n    names_to = \"年龄段\",\n    names_pattern = \"([^性]+)\",\n    values_to = \"性别比\"\n  ) %&gt;% \n  rename(总体性别比 = `性别比(女=100)(人口抽样调查)`)\ndt_list$dt_gender\n\n# A tibble: 160 × 4\n    year 总体性别比 年龄段  性别比\n   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;\n 1  2022       104. 0-4岁     110.\n 2  2022       104. 5-9岁     112.\n 3  2022       104. 10-14岁   115.\n 4  2022       104. 15-19岁   116.\n 5  2022       104. 20-24岁   114.\n 6  2022       104. 25-29岁   111.\n 7  2022       104. 30-34岁   108.\n 8  2022       104. 35-39岁   106.\n 9  2022       104. 40-44岁   105.\n10  2022       104. 45-49岁   104.\n# ℹ 150 more rows\n\n\n\n# 总人口\ndt_list$dt_population &lt;- dt_list$dt_population %&gt;% \n  pivot_longer(\n    cols = - c(year, `年末总人口(万人)`),\n    names_to = \"类别\",\n    names_pattern = \"([^人]+)\",\n    values_to = \"人口数_万人\"\n  ) %&gt;% \n  rename(总人口_万人 = `年末总人口(万人)`)\ndt_list$dt_population\n\n# A tibble: 36 × 4\n    year 总人口_万人 类别  人口数_万人\n   &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;\n 1  2022      141175 男性        72206\n 2  2022      141175 女性        68969\n 3  2022      141175 城镇        92071\n 4  2022      141175 乡村        49104\n 5  2021      141260 男性        72311\n 6  2021      141260 女性        68949\n 7  2021      141260 城镇        91425\n 8  2021      141260 乡村        49835\n 9  2020      141212 男性        72357\n10  2020      141212 女性        68855\n# ℹ 26 more rows\n\n\n\n# 年龄结构\ndt_list$dt_age &lt;- dt_list$dt_age %&gt;% \n  pivot_longer(\n    cols = - c(year, `年末总人口(万人)`, contains(\"抚养比\")),\n    names_to = \"年龄段\",\n    names_pattern = \"([^人]+)\",\n    values_to = \"人口_万人\"\n  ) %&gt;% \n  mutate(抚养比 = case_when(\n    年龄段 == \"0-14岁\" ~ `少儿抚养比(%)`,\n    年龄段 == \"65岁及以上\" ~ `老年抚养比(%)`,\n    TRUE ~ NA\n  )) %&gt;% \n  select(-`少儿抚养比(%)`, -`老年抚养比(%)`)\n\ndt_list$dt_age\n\n# A tibble: 27 × 6\n    year `年末总人口(万人)` `总抚养比(%)` 年龄段     人口_万人 抚养比\n   &lt;dbl&gt;              &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;\n 1  2022             141175          46.6 0-14岁         23908   24.8\n 2  2022             141175          46.6 15-64岁        96289   NA  \n 3  2022             141175          46.6 65岁及以上     20978   21.8\n 4  2021             141260          46.3 0-14岁         24678   25.6\n 5  2021             141260          46.3 15-64岁        96526   NA  \n 6  2021             141260          46.3 65岁及以上     20056   20.8\n 7  2020             141212          45.9 0-14岁         25277   26.2\n 8  2020             141212          45.9 15-64岁        96871   NA  \n 9  2020             141212          45.9 65岁及以上     19064   19.7\n10  2019             141008          41.5 0-14岁         23689   23.8\n# ℹ 17 more rows\n\n\n婚姻状况的数据比较复杂，存在许多缺失值。\n\ndt_list$dt_marriage %&gt;% \n  mutate(across(-year, is.na)) %&gt;% \n  pivot_longer(cols = -year) %&gt;% \n  mutate(name = fct(name, levels = colnames(dt_list$dt_marriage))) %&gt;% \n  ggplot(aes(x = year, y = fct_rev(name), fill = value)) +\n  geom_tile() +\n  scale_fill_brewer(palette = \"Paired\", direction = -1,\n                    limits = c(FALSE, TRUE), labels = c(\"存在\", \"缺失\")) +\n  theme(legend.position = \"top\") +\n  coord_equal(xlim = c(2003.5, 2023.5), expand = FALSE) +\n  labs(x = \"年份\", y = \"类别\", fill = \"数据是否存在\")\n\n\n\n\n\n\n\n\n由上图可知，和配偶相关的数据在2015年以后被整合为有配偶人数、男性有配偶人数和女性有配偶人数。为保持一致，需要把2015年前的数据也整合起来。\n\n# 婚姻状况\ndt_list$dt_marriage &lt;- dt_list$dt_marriage %&gt;% \n  mutate(`15岁及以上男性有配偶人口数(人口抽样调查)(人)` = rowSums(pick(matches(\"男性.*有配偶\")), na.rm = TRUE),\n         `15岁及以上女性有配偶人口数(人口抽样调查)(人)` = rowSums(pick(matches(\"女性.*有配偶\")), na.rm = TRUE),\n         `15岁及以上有配偶人口数(人口抽样调查)(人)` = `15岁及以上男性有配偶人口数(人口抽样调查)(人)` + `15岁及以上女性有配偶人口数(人口抽样调查)(人)`) %&gt;% \n  select(-matches(\"婚有配偶\")) %&gt;% \n  mutate(across(everything(), \\(x) if_else(x == 0, NA, x)))\n\n\ndt_list$dt_marriage %&gt;% \n  mutate(across(-year, is.na)) %&gt;% \n  pivot_longer(cols = -year) %&gt;% \n  mutate(name = fct(name, levels = colnames(dt_list$dt_marriage))) %&gt;% \n  ggplot(aes(x = year, y = fct_rev(name), fill = value)) +\n  geom_tile() +\n  scale_fill_brewer(palette = \"Paired\", direction = -1,\n                    limits = c(FALSE, TRUE), labels = c(\"存在\", \"缺失\")) +\n  labs(fill = \"数据是否存在\") +\n  theme(legend.position = \"top\") +\n  coord_equal(xlim = c(2003.5, 2023.5), expand = FALSE) +\n  labs(x = \"年份\", y = \"类别\")\n\n\n\n\n\n\n\n\n\ndt_list$dt_marriage &lt;- dt_list$dt_marriage %&gt;% \n  select(year, contains(\"性\"), - `15岁及以上男性人口数(人口抽样调查)(人)`, - `15岁及以上女性人口数(人口抽样调查)(人)`) %&gt;% \n  pivot_longer(\n    cols = - year,\n    names_to = c(\"性别\", \"婚姻状况\"),\n    names_pattern = \"15岁及以上(.性)([^人]+)\",\n    values_to = \"人口数\"\n  )"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#总人口数据",
    "href": "posts/01-first/十年来人口数据分析.html#总人口数据",
    "title": "人口数据",
    "section": "总人口数据",
    "text": "总人口数据\n十年来人口趋势\n\np_pop_gen_1 &lt;- dt_list$dt_population %&gt;% \n  filter(str_detect(类别, \"性\")) %&gt;% \n  ggplot(aes(x = year, y = 人口数_万人, color = 类别)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  scale_y_continuous(labels = scales::label_comma()) +\n  labs(x = \"年份\", y = \"人口数(万人)\")\n\n\np_pop_gen_2 &lt;- dt_list$dt_population %&gt;% \n  mutate(所占比例 = 人口数_万人 / 总人口_万人) %&gt;% \n  filter(str_detect(类别, \"性\")) %&gt;% \n  ggplot(aes(x = year, y = 所占比例, color = 类别)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  scale_y_continuous(labels = scales::label_percent(), limits = c(0.425, 0.575)) +\n  labs(x = \"年份\")\n\n\nlibrary(patchwork)\np_pop_gen_1 / p_pop_gen_2 +\n plot_layout(guides = \"collect\") +\n  plot_annotation(title = \"2014 - 2022 男女人口趋势\")&\n  scale_color_viridis_d(option = \"C\", end = 0.5)\n\n\n\n\n\n\n\n\n从2014年到2022年，男女人口数量的上升趋于平缓，而男女的比例大致不变。\n\np_pop_city_1 &lt;- dt_list$dt_population %&gt;% \n  filter(!str_detect(类别, \"性\")) %&gt;% \n  ggplot(aes(x = year, y = 人口数_万人, color = 类别)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  scale_y_continuous(labels = scales::label_comma()) +\n  labs(x = \"年份\", y = \"人口数(万人)\")\n\n\np_pop_city_2 &lt;- dt_list$dt_population %&gt;% \n  mutate(所占比例 = 人口数_万人 / 总人口_万人) %&gt;% \n  filter(!str_detect(类别, \"性\")) %&gt;% \n  ggplot(aes(x = year, y = 所占比例, color = 类别)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  scale_y_continuous(labels = scales::label_percent(), limits = c(0.25, 0.75)) +\n  labs(x = \"年份\")\n\n\np_pop_city_1 / p_pop_city_2 +\n  plot_layout(guides = \"collect\") +\n  plot_annotation(title = \"2014 - 2022 城乡人口变化\") &\n  scale_color_viridis_d(option = \"C\", end = 0.5)\n\n\n\n\n\n\n\n\n从2014年到2022年，农村人口不断流向城市。"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#出生率死亡率自然增长率",
    "href": "posts/01-first/十年来人口数据分析.html#出生率死亡率自然增长率",
    "title": "人口数据",
    "section": "出生率死亡率自然增长率",
    "text": "出生率死亡率自然增长率\n\ndt_list$dt_rate %&gt;% \n  mutate(alpha = if_else(比率名称 == \"死亡率\", 0.25, 1)) %&gt;% \n  ggplot(aes(x = year, y = 比值/100, color = 比率名称, alpha = alpha)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  scale_y_continuous(labels = scales::label_percent()) +\n  scale_alpha(range = c(0.25, 1)) +\n  scale_color_viridis_d(option = \"C\", end = 0.5) +\n  labs(y = \"比值\", x = \"年份\", title = \"2014 - 2022 \\n人口出生率、死亡率、自然增长率\") +\n  guides(alpha = \"none\") \n\n\n\n\n\n\n\n\n从上图可以看出，十年来死亡率基本持平而，自然增长率的下降主要是由于出生率的下降而导致的。"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#年龄结构",
    "href": "posts/01-first/十年来人口数据分析.html#年龄结构",
    "title": "人口数据",
    "section": "年龄结构",
    "text": "年龄结构\n\np_age_1 &lt;- dt_list$dt_age %&gt;% \n  ggplot(aes(year, 人口_万人, color = 年龄段)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  scale_y_continuous(labels = scales::label_comma()) +\n  labs(y = \"人口（万人）\", x = \"年份\")\n\n\np_age_2 &lt;- dt_list$dt_age %&gt;% \n  # filter(!is.na(抚养比)) %&gt;% \n  ggplot(aes(year, 抚养比/100, color = 年龄段)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  #scale_color_discrete(breaks = c(\"0-14岁\", \"65岁及以上\")) +\n  scale_y_continuous(labels = scales::label_percent()) +\n  labs(y = \"抚养比\", x = \"年份\")\n\np_age_1 / p_age_2 +\n  plot_annotation(title = \"2014-2022 年龄结构\") +\n  plot_layout(guides = \"collect\") &\n  scale_color_viridis_d(option = \"C\", end = 0.5)\n\nWarning: Removed 9 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\nWarning: Removed 9 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n人口的抚养比不断攀升，0-14岁的抚养比在2020年达到顶点后略有下降，而65岁及以上人群的抚养比在不断上升，反映出当前社会的老龄化现象正越来越严重。"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#人口年龄分布",
    "href": "posts/01-first/十年来人口数据分析.html#人口年龄分布",
    "title": "人口数据",
    "section": "人口年龄分布",
    "text": "人口年龄分布\n\ndt_list$dt_age_dist %&gt;% \n  ggplot(aes(x = year, y = 总人口数)) +\n  geom_line(linewidth = 2, col = \"#A52A2A\") +\n  geom_point(size = 4, col = \"#A52A2A\") +\n  scale_y_continuous(labels = scales::label_comma()) +\n  labs(x = \"年份\", y = \"样本量\", title = \"2014-2022 样本量\")\n\nWarning: Removed 20 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\nWarning: Removed 40 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n该数据是抽样数据，且由上图可以看出，2015年所抽查的样本数量远高于其他年份，因此采用比例数据代替原有数据。\n\ndt_list$dt_age_dist %&gt;% \n  mutate(占总人口比例 = 人口数 / 总人口数) %&gt;% \n  ggplot(aes(x = 年龄段, y = 占总人口比例, fill = 年龄段)) +\n  geom_col() +\n  facet_wrap(vars(year), nrow = 2) +\n  scale_fill_viridis_d(option = \"C\") +\n  scale_x_discrete(breaks = c(\"0-4岁\", \"75-79岁\")) +\n  scale_y_continuous(labels = scales::label_percent()) +\n  guides(fill = \"none\") +\n  theme(axis.text.x = element_text(angle = - 45)) +\n  labs(title = \"2014-2022 人口年龄分布\")\n\nWarning: Removed 40 rows containing missing values or values outside the scale range\n(`geom_col()`).\n\n\n\n\n\n\n\n\n\n人口结构呈现出纺锤型，还未变为倒金字塔型。\n\ndt_list$dt_age_dist %&gt;% \n  mutate(占总人口比例 = 人口数 / 总人口数,\n         age_num = as.integer(str_extract(年龄段, \"[^-|岁]+\"))) %&gt;% \n  arrange(year) %&gt;% \n  mutate(first_ob = first(占总人口比例),\n         last_ob = nth(占总人口比例, -2),\n         .by = 年龄段) %&gt;% \n  mutate(alpha = if_else(last_ob - first_ob &lt; 0, 1, 0.7)) %&gt;% \n  mutate(label = if_else(year == 2022 & alpha == 1, 年龄段, NA),\n         label_y = if_else(!is.na(label), 占总人口比例, NA)) %&gt;% \n  ggplot(aes(x = year, y = 占总人口比例, color = age_num, group = age_num, alpha = alpha)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  geom_label_repel(aes(x = 2022, y = label_y, label = label), nudge_x = 2.2, nudge_y = 0.015, seed = 123) +\n  labs(color = \"年龄段\") +\n  scale_color_viridis_c(option = \"C\", breaks = c(0, 25, 50, 75), labels = c(\"0-4岁\", \"25-29岁\", \"50-54岁\", \"75-79岁\")) +\n  scale_y_continuous(labels = scales::label_percent()) +\n  scale_alpha_continuous(range = c(0.3, 1)) +\n  guides(alpha = \"none\") +\n  labs(x = \"年份\", title = \"2014-2022 年龄分布变化\")\n\nWarning: Removed 20 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\nWarning: Removed 40 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\nWarning: Removed 193 rows containing missing values or values outside the scale range\n(`geom_label_repel()`).\n\n\n\n\n\n\n\n\n\n可以看出,与十年前相比，年轻人在总人口中所占的比例不断下降，0-4岁人群在总人口中所占的比例下降尤为明显。"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#男性年龄分布与女性年龄分布",
    "href": "posts/01-first/十年来人口数据分析.html#男性年龄分布与女性年龄分布",
    "title": "人口数据",
    "section": "男性年龄分布与女性年龄分布",
    "text": "男性年龄分布与女性年龄分布\n\ndt_gender &lt;- dt_list$dt_male %&gt;% \n  bind_rows(dt_list$dt_female) \n\ndt_gender &lt;- dt_list$dt_age_dist %&gt;% \n  rename(该年龄段总人数 = 人口数) %&gt;%\n  left_join(dt_gender, join_by(year, 年龄段)) %&gt;% \n  mutate(该性别总人数 = sum(人口数), .by = c(year, 性别)) %&gt;% \n  relocate(year, 年龄段, 性别, 人口数, 该性别总人数, 该年龄段总人数)\n\ndt_gender\n\n# A tibble: 360 × 7\n    year 年龄段  性别  人口数 该性别总人数 该年龄段总人数 总人口数\n   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt;\n 1  2023 0-4岁   &lt;NA&gt;      NA           NA             NA       NA\n 2  2023 5-9岁   &lt;NA&gt;      NA           NA             NA       NA\n 3  2023 10-14岁 &lt;NA&gt;      NA           NA             NA       NA\n 4  2023 15-19岁 &lt;NA&gt;      NA           NA             NA       NA\n 5  2023 20-24岁 &lt;NA&gt;      NA           NA             NA       NA\n 6  2023 25-29岁 &lt;NA&gt;      NA           NA             NA       NA\n 7  2023 30-34岁 &lt;NA&gt;      NA           NA             NA       NA\n 8  2023 35-39岁 &lt;NA&gt;      NA           NA             NA       NA\n 9  2023 40-44岁 &lt;NA&gt;      NA           NA             NA       NA\n10  2023 45-49岁 &lt;NA&gt;      NA           NA             NA       NA\n# ℹ 350 more rows\n\n\n\ndt_gender %&gt;% \n  filter(!is.na(性别)) %&gt;% \n  mutate(占该性别总人口数的比例 = 人口数 / 该性别总人数) %&gt;% \n  ggplot(aes(x = 年龄段, y = 占该性别总人口数的比例, fill = 年龄段)) +\n  geom_col() +\n  facet_grid(性别 ~ year) +\n  scale_fill_viridis_d(option = \"C\") +\n  scale_x_discrete(breaks = c(\"0-4岁\", \"75-79岁\")) +\n  scale_y_continuous(labels = scales::label_percent()) +\n  guides(fill = \"none\") +\n  theme(axis.text.x = element_text(angle = -45)) +\n  labs(title = \"2014-2022 男女年龄分布\")\n\n\n\n\n\n\n\n\n\ndt_gender %&gt;% \n  filter(!is.na(性别)) %&gt;% \n  mutate(占该性别总人口数的比例 = 人口数 / 该性别总人数,\n         age_num = as.integer(str_extract(年龄段, \"[^-|岁]+\"))) %&gt;% \n  arrange(year) %&gt;% \n  mutate(first_ob = first(占该性别总人口数的比例),\n         last_ob = nth(占该性别总人口数的比例, -2),\n         .by = 年龄段) %&gt;% \n  mutate(alpha = if_else(last_ob - first_ob &lt; 0, 1, 0.7)) %&gt;% \n  mutate(label = if_else(year == 2022 & alpha == 1, 年龄段, NA),\n         label_y = if_else(!is.na(label), 占该性别总人口数的比例, NA)) %&gt;% \n  ggplot(aes(x = year, y = 占该性别总人口数的比例, color = age_num, group = age_num, alpha = alpha)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  geom_label_repel(aes(x = 2022, y = label_y, label = label), nudge_x = 2.2, nudge_y = 0.015, seed = 123) +\n  labs(color = \"年龄段\") +\n  facet_wrap(vars(性别), nrow = 1) +\n  scale_color_viridis_c(option = \"C\", breaks = c(0, 25, 50, 75), labels = c(\"0-4岁\", \"25-29岁\", \"50-54岁\", \"75-79岁\")) +\n  scale_y_continuous(labels = scales::label_percent()) +\n  scale_alpha_continuous(range = c(0.3, 1)) +\n  guides(alpha = \"none\")  +\n  theme(legend.position = \"bottom\", \n        legend.key.width = unit(35, \"pt\")) +\n  labs(title = \"2014-2022 男女年龄分布变化\", x = \"年份\")\n\nWarning: Removed 306 rows containing missing values or values outside the scale range\n(`geom_label_repel()`).\n\n\n\n\n\n\n\n\n\n男性与女性年龄分布的变化与总人口年龄分布的变化一致。"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#性别比",
    "href": "posts/01-first/十年来人口数据分析.html#性别比",
    "title": "人口数据",
    "section": "性别比",
    "text": "性别比\n\ndt_list$dt_gender\n\n# A tibble: 160 × 4\n    year 总体性别比 年龄段  性别比\n   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;\n 1  2022       104. 0-4岁     110.\n 2  2022       104. 5-9岁     112.\n 3  2022       104. 10-14岁   115.\n 4  2022       104. 15-19岁   116.\n 5  2022       104. 20-24岁   114.\n 6  2022       104. 25-29岁   111.\n 7  2022       104. 30-34岁   108.\n 8  2022       104. 35-39岁   106.\n 9  2022       104. 40-44岁   105.\n10  2022       104. 45-49岁   104.\n# ℹ 150 more rows\n\n\n\ndt_list$dt_gender %&gt;% \n  mutate(age_num = as.integer(str_extract(年龄段, \"[^-|岁]+\"))) %&gt;% \n  ggplot(aes(year, 性别比/100 , color = age_num, group = age_num)) +\n  geom_line(linewidth = 2, alpha = 0.4) +\n  geom_point(size = 4, alpha = 0.4) +\n  geom_line(aes(year, 总体性别比/100), color = 'steelblue',\n            linewidth = 2) +\n  geom_point(aes(year, 总体性别比/100), color = 'steelblue', size = 4) +\n  geom_label(x = 2022.2, y = 1.04, label = \"总体性别比\", \n             fill = \"steelblue\", color = \"white\", hjust = 0) +\n  scale_color_viridis_c(option = \"C\", breaks = c(0, 25, 50, 75), labels = c(\"0-4岁\", \"25-29岁\", \"50-54岁\", \"75-79岁\"), end = 0.95) +\n  scale_y_continuous(labels = scales::label_percent(), n.breaks = 10) +\n  labs(color = \"年龄段\", y = \"性别比\", x = \"年份\", title = \"2014-2022 男女性别比\") +\n  xlim(2014, 2023.5)\n\n\n\n\n\n\n\n\n上图表明，在年轻群体中性别比往往较高，但情况在近年有所改善。\n考虑到许多情况下，在一对夫妻中，男性往往比女性年长，构造错位性别比：比如5-9岁的男性人数与0-4岁的女性人数之比。\n\ndt_male &lt;- dt_list$dt_male %&gt;% \n  mutate(人口数 = lead(人口数),\n         .by = year) %&gt;% \n  rename(男性人口数 = 人口数)\ndt_female &lt;- dt_list$dt_female %&gt;%\n  # mutate(人口数 = lead(人口数),\n  #        .by = year) %&gt;%\n  rename(女性人口数 = 人口数)\ndt_gender &lt;- dt_male %&gt;% \n  left_join(dt_female, join_by(year, 年龄段))\n\n\ndt_gender %&gt;% \n  rename(女性年龄段 = 年龄段) %&gt;% \n  mutate(总体性别比 = sum(男性人口数, na.rm = TRUE) / sum(女性人口数, na.rm = TRUE), .by = year) %&gt;% \n  mutate(性别比 = 男性人口数 / 女性人口数,\n         age_num = as.integer(str_extract(女性年龄段, \"[^-|岁]+\"))) %&gt;% \n  ggplot(aes(year, 性别比 , color = age_num, group = age_num)) +\n  geom_line(linewidth = 2, alpha = 0.4) +\n  geom_point(size = 4, alpha = 0.4) +\n  geom_line(aes(year, 总体性别比), color = 'steelblue',\n            linewidth = 2) +\n  geom_point(aes(year, 总体性别比), color = 'steelblue', size = 4) +\n  geom_label(x = 2022.2, y = 1.04, label = \"总体性别比\", \n             fill = \"steelblue\", color = \"white\", hjust = 0) +\n  scale_color_viridis_c(option = \"C\", breaks = c(0, 25, 50, 75), labels = c(\"0-4岁\", \"25-29岁\", \"50-54岁\", \"75-79岁\"), end = 0.9) +\n  scale_y_continuous(labels = scales::label_percent(), n.breaks = 10) +\n  labs(color = \"女性年龄段\", y = \"性别比\", x = \"年份\", title = \"2014-2022 男女性别比\") +\n  xlim(2014, 2024)\n\nWarning: Removed 8 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\nWarning: Removed 8 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n可以看出，错位性别比相较于性别比更加失衡。预计未来的婚姻市场的竞争会更加激烈，但也会出现越来越多的女性与较自己年轻的男性结婚。"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#受教育程度",
    "href": "posts/01-first/十年来人口数据分析.html#受教育程度",
    "title": "人口数据",
    "section": "受教育程度",
    "text": "受教育程度\n该数据也是抽样数数据，每年的样本量不同，应该转化为比例数据\n\ndt_list$dt_education %&gt;% \n  mutate(总人口数 = sum(人口数), .by = year) %&gt;% \n  mutate(所占比例 = 人口数 / 总人口数,\n         教育程度 = factor(教育程度, levels = c(\"大专及以上\", \"高中\", \"初中\", \"小学\", \"未上过学\"))) %&gt;% \n  ggplot(aes(year, 所占比例, color = 教育程度, \n             shape = 性别, alpha = 教育程度)) +\n  geom_line(linewidth = 1.8) +\n  geom_point(size = 3.5) +\n  facet_wrap(vars(性别), nrow = 2) +\n  scale_alpha_manual(values = c(1, rep(0.4, 4))) +\n  scale_y_continuous(labels = scales::label_percent()) +\n  scale_color_viridis_d(option = \"C\", end = 0.8) +\n  labs(x = \"年份\", title = \"2004-2023 受教育情况\") +\n  guides(shape = \"none\")\n\n\n\n\n\n\n\n\n中国人的受教育水平在不断提高，教育程度在大专及以上的人显著上升。"
  },
  {
    "objectID": "posts/01-first/十年来人口数据分析.html#婚姻状况",
    "href": "posts/01-first/十年来人口数据分析.html#婚姻状况",
    "title": "人口数据",
    "section": "婚姻状况",
    "text": "婚姻状况\n该数据集也是抽样数据，也需要转化为比例数据。\n\ndt_list$dt_marriage %&gt;% \n  mutate(总人口数 = sum(人口数), .by = year) %&gt;% \n  mutate(所占比例 = 人口数 / 总人口数,\n         婚姻状况 = factor(婚姻状况, c(\"未婚\", \"有配偶\", \"离婚\", \"丧偶\"))) %&gt;% \n  ggplot(aes(year, 所占比例, color = 婚姻状况, \n             shape = 性别, alpha = 婚姻状况)) +\n  geom_line(linewidth = 2) +\n  geom_point(size = 4) +\n  facet_wrap(vars(性别), nrow = 1) +\n  scale_y_continuous(labels = scales::label_percent()) +\n  scale_color_viridis_d(option = \"C\", end = 0.5) +\n  scale_alpha_manual(values = c(1, rep(0.4, 3))) +\n  labs(x = \"年份\", title = \"2004-2023 婚姻状况\") +\n  guides(shape = \"none\") +\n  theme(legend.position = \"bottom\")\n\nWarning: Removed 8 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\nWarning: Removed 24 rows containing missing values or values outside the scale range\n(`geom_point()`).\n\n\n\n\n\n\n\n\n\n男性未婚人口所占的比例在上升地十分明显，预计在未来，男性在婚姻市场上面临的竞争会更加激烈。"
  }
]